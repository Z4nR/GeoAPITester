<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
      integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
      crossorigin=""
    />
  </head>
  <body>
    <div id="map" style="height: 800px"></div>
  </body>
  <script
    src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
    integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
    crossorigin=""
  ></script>
  <script>
    const map = L.map("map").setView([-1.2480891, 115.419], 5);
    L.tileLayer(
      "https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}",
      {
        attribution:
          'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
        maxZoom: 18,
        id: "mapbox/streets-v11",
        tileSize: 512,
        zoomOffset: -1,
        accessToken:
          "pk.eyJ1IjoiejRuciIsImEiOiJja2pzand4cW4xMm45Mnl0Y2RvdjJtZHYxIn0.Rn_hw5jHlwnMJ5BVcQ8egg",
      }
    ).addTo(map);

    const BASE_URL = "https://brainy-rose-rugby-shirt.cyclic.app/v1";

    async function getPageSize() {
      const response = await fetch(`${BASE_URL}/get-prov-page`);
      const data = await response.json();
      const pageSize = data.totalPage;
      return pageSize;
    }

    async function getProvinces() {
      const pageSize = await getPageSize();
      const provData = [];
      const response = await fetch(`${BASE_URL}/get-province-all?page=4`);
      const allData = await Promise.all(
        Array(pageSize)
          .fill(null)
          .map((_, index) =>
            fetch(`${BASE_URL}/get-province-all?page=${index + 1}`).then(
              (res) => res.json()
            )
          )
      );
      const mixData = allData.flat();
      for (r of mixData) {
        provData.push(r);
      }

      console.log(provData);

      const prov = provData.find((d) => {
        L.geoJSON(d.provFeature).addTo(map);
      });

      return prov;
    }

    getProvinces();
  </script>
</html>
